# 飞书多维表格插件代码规范

在插件审核时，团队会对代码进行 Review，以排除数据安全、性能等方面的隐患。以下规范适用于插件在多维表格上架前的准备工作。

## 插件上架步骤

1. **本地打包**
   - 我们将直接静态部署前端产物，以避免二次构建打包，首先需要指定构建产物目录，比如指定部署dist/index.html，
   
     在 `package.json` 中设置 `output` 属性值为"dist"即可，注意需要同时去掉.gitignore文件中的dist，并在每次代码更新之后重新打包构建一下，然后将重新构建(`npm run build`)的dist上传即可。

   ```json
   {
     "output": "dist" // 指定直接上传 dist 目录了
   }
   ```

   - 同时需要注意的是，打包产物的资源引用路径不可以使用绝对路径，请使用相对路径，如在vite.config.js中指定 base:'./'：

   ```ts
   import { defineConfig } from "vite";
   
   export default defineConfig({
     base: "./", // 使用相对路径
     // ...
   });
   ```

2. **禁止使用 history 路由，统一采用 hash 路由。**
3. **填写共享表单。**
4. **多维表格审核通过后会 Fork 和部署你的项目初始化配置**
   
   - 插件运行时，需要基于插件功能遍历当前多维表格数据结构，进行初始化配置。如无法获取正确的数据结构，或必须依赖选中单元格，则需给出明确提示，引导用户如何操作，避免产生疑惑。

## 通用初始化配置逻辑

- 遍历所有表的字段类型。
- 遍历所有表的记录数。
- 选取符合字段类型要求且记录数最多的表
- 如对字段类型无严格限制，则直接判断记录数
- 如所有表都没有记录，则用第一个张表
- 按返回序列为插件配置项匹配适合的字段

## 监听事件

前端项目应当实时监听`base`、`table`、`view`、`field`、`record`、`cell`的数据变化，以及选中状态变化。当上述维度发生改变时，插件应当即时响应，而无需用户手动刷新。

## 性能要求

在批量操作数据时，建议使用 [addRecords](https://lark-base-team.github.io/js-sdk-docs/zh/api/table#addrecords)、[setRecords](https://lark-base-team.github.io/js-sdk-docs/zh/api/table#setrecords)、[deleteRecords](https://lark-base-team.github.io/js-sdk-docs/zh/api/table#deleterecords)、[getRecords](https://lark-base-team.github.io/js-sdk-docs/zh/api/table#getrecords) 等批量接口来增删改查行记录，而不是使用单次接口循环遍历。

## 数据安全

为确保数据安全，除插件功能必要的 API 请求外，禁止将多维表格数据向外部发送。
